
<BackgroundColor@Widget>
    background_color: 1, 1, 0, 0.5
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos
# Now you can simply Mix the `BackgroundColor` class with almost any other widget... to give it a background.
<BackgroundLabel@Label+BackgroundColor>
    background_color: 0.3, 0.6, 0.6, 1
<BackgroundButton@Button+BackgroundColor>
    background_color: 1, 0, 1, 1
    # Default the background color for this label
    # to r 0, g 0, b 0, a 0
# Use the BackgroundLabel any where in your kv code like below

<Controller>
    cols:4
    rows:1

    ScriptManager
        id:scriptManager
    ExecuteList
        id:executeList

    GridLayout:
        rows:2
        cols:1
        width:250
        size_hint_x:None
        
        ScriptSettings
            id:scriptSettings

        ScriptExecute

    Log
        id:logPanel


<RecycleViewItem>
    height:"48sp"
    size_hint_y:None

    canvas:
        Color:
            rgb:.3,.8,.8 
                        
        Rectangle:
            pos:self.pos
            size:self.width,1

        Rectangle:
            pos:self.pos
            size:10,self.height

    BoxLayout:
        padding:"5dp"

        BoxLayout:
            padding:5
            orientation:'vertical'

            Label:
                text:root.script_title   
                halign: 'left'
                width:200
                height:30
                size_hint_x:None
                text_size:self.width-10,None
                shorten:True
                shorten_from:"right"

            Label:
                text:root.script_args
                font_size:12                
                text_size:self.width-10,None                
                shorten:True
                shorten_from:"right"
                        
        Button:
            text:"Single\nExecute"   
            width:80 
            size_hint_x:None
            on_release:app.handle_singleExecute(root)

        Button:
            text:"edit"         
            size_hint_x:None
            width:self.height+10
            on_release:root.call_ScriptArgsEditPopup(root)

        Button:
            text:">"
            size_hint_x:None
            width:self.height-10
            on_release:app.handle_script_selected(root)
            disabled:root.is_selected
           # state: "normal"

<ScriptEditItem>
    orientation:'horizontal'
    valign:"top"
    height:30
    size_hint_y:None

    TextInput:        
        size_hint_x:.35
        id:argsName_input
        text:root.argsName
        font_size:14
    TextInput:
        size_hint_x:.6
        id:argsCount_input
        text:root.argsCount
        font_size:14
    
    Button:
        size_hint_x:.05
        text:"-"
        width:self.height
        height:30
        size_hint_x:None
        on_release:root.handle_reduceItem(root)

            


<ScriptArgsEditPopup>:    
    size:700,300
    size_hint:None,None
    auto_dismiss: False
    title: '-'
    

    BoxLayout:
        orientation:'horizontal'

        BoxLayout:            
            size_hint_x:.6
            orientation:'vertical'
            padding:5
            ssize_hint_x:None

            BoxLayout:
                orientation:'horizontal'
                height:30
                size_hint_y:None
                Label:
                    text:"ArgsName"
                Label:
                    text:"ArgsCount"

            BoxLayout:        
                id:scriptEdit_itemList
                orientation:'vertical'      
                valign:"top"          
 

            Button:
                height:30
                text:"+"
                size_hint_y:None
                on_release:root.handle_addItems()
 

        BoxLayout:
            size_hint_x:.32
            orientation:'vertical'
            padding:5

            BoxLayout:
                orientation:'vertical'
                size_hint_y:.8

                Label:
                    text:"Saved ArgsPlan"
                    size_hint_y:.2

                RecycleView:
                    data:root.data_for_loadConfigList
                    viewclass:'LoadListPopUpItem_ScriptEdit'
                    RecycleBoxLayout:
                        default_size:None,dp(30)
                        default_size_hint:1,None
                        size_hint_y:None
                        height:self.minimum_height
                        orientation:"vertical"
                        spacing:dp(2)



        BoxLayout:
            orientation:'vertical'
            size_hint_x:.08
            Button:
                text: 'Save\nArgs'
                on_press: root.handle_saveArgs()

            Button:
                text: 'Save\nPlan'
                on_press: root.handle_scriptEdit_save()


            Button:
                text:"Cancel"
                on_release: root.dismiss()

<SaveEditArgsPlanNamePopUp>
    size_hint:.3,.3

    BoxLayout:
        orientation: 'vertical'

        Label:
            text:"Input the EditArgsPlan's name :"
            shorten_from:"right" 
            size_hint_x:0.5                   
            size_hint_y:.4

        TextInput:            
            id:savePlanName
            size_hint_y:.5                        
            multiline:False

        Label:
            height:5
            size_hint_y:.1

        BoxLayout:
            orientation:'horizontal'
            padding:4
            height:42
            size_hint_y:None

            Button:
                text:"Save"
                on_release:app.handle_saveScriptEditData(root)

            Button:
                text:"Cancel"
                on_release:root.dismiss()
        

<ScriptManager>
    id: scriptManager
    orientation:"vertical"
    width:380
    size_hint_x:None

    __safe_id: [dropdown.__self__]

    BackgroundLabel:
        text:"ScriptManager"
        background_color:.3,.3,.3,1
        height:36
        size_hint_y:None

    BoxLayout:
        orientation:"horizontal"
        height:'26dp'
        size_hint_y:None

        BackgroundLabel:
            valign:"middle"
            text:"Games: "            
            background_color: .5, .5, .5,1
            width:'70dp'
            size_hint_x:None
        

        Button:
            id:dropdown_mainBtn
            text:root.selectedGame
            size_hint_x:None
            width:200
            on_press:root.refresh_DropDownList()
            on_release:dropdown.open(self)
            
        Widget:
            on_parent:dropdown.dismiss()

        DropDown:
            id:dropdown
            on_select:root.handle_DropDownSelect()



    RecycleView:
        data:root.data_for_scriptList
        viewclass:"RecycleViewItem"
        RecycleBoxLayout:
            default_size:None,dp(56)
            default_size_hint:1,None
            size_hint_y:None
            height:self.minimum_height
            orientation:"vertical"
            spacing:dp(2)


<SingleExecutePopUp>
    size_hint:.3,.35

    BoxLayout:
        orientation:'vertical'
        padding:5
        size_hint_y:1
        valign: "top"

        Label:
            text:"Progression: {}%".format(str(pb.value))
            size_hint_y:.8
            valign:"middle"

        ProgressBar:        
            id:pb
            height:16
            size_hint_y:None
            size_hint_x:1
            value:root.now_progress
            
        Label:
            id:passTime
            text:"Passed time: " + app.passTime
            valign:'top'
            size_hint_y:1
            
            
        BoxLayout:
            orientation:'horizontal'
            valign:"bottom"
            size_hint_y:.8
            
            Button:
                text:"Stop"
                on_release:app.handle_stopNowProcess()

            Button:
                text:"Close"
                on_release:root.dismiss()

<ExecuteList>
    orientation:"vertical"
    width:320
    size_hint_x:None

    BackgroundLabel:
        text:"Prepare for Execute"
        valign:"top"
        height:36
        size_hint_y:None    
        background_color: .4, .4, .4,1

    BoxLayout:
        height:32
        size_hint_y:None
        orientation:'vertical'

        canvas:
            Color:
                rgb:.8,.4,.4 

            Rectangle:
                pos:self.pos
                size: self.width,2

        BoxLayout:
            orientation:'horizontal'

            Label:
                id:scriptCount
                text:"Scripts: {}/{}".format(root.accomplishedScriptNumber, len(root.data))

            Label:
                id:timeCounter
                text:"Times: " + app.passTime

            Label:
                id:stepCounter
                text:"Steps: " + app.stepCount
        

    RecycleView:
        id:executeList_RecycleView
        data:root.data_for_ExecuteList
        viewclass:"ExecuteListRecycleViewItem"
        RecycleBoxLayout:
            default_size:None,dp(42)
            default_size_hint:1,None
            size_hint_y:None
            height:self.minimum_height
            orientation:"vertical"
            spacing:dp(2)

    

    BoxLayout:
        height:60
        size_hint_y:None
        Button:
            text:"SaveList"
            on_release:root.call_saveListPopUp()

        Button:
            text:"LoadList"
            on_release:root.call_loadListPopUp()



<ExecuteListRecycleViewItem>:
    height:20
    orientation:'vertical'
    size_hint_y:None
    padding:3
    
    BoxLayout:
        padding:2

        Button:
            text:"<"
            size_hint_x:None
            width:self.height
            on_release:app.handle_script_selected_cancel(root)

        BoxLayout:
            padding:5
            orientation:'horizontal'

            Label:
                text:root.script_title   
                halign: 'left'
                width:120
                height:20
                size_hint_x:None
                text_size:self.width-10,None
                max_lines:2
                line_height:0.8

            Label:
                text:root.script_args
                font_size:12                
                text_size:self.width-10,None                
                max_lines:2
        
    ProgressBar:
        id:pb
        height:2
        size_hint_y:None
        value:root.now_progress

<SaveListPopUp>
    size_hint:.4,.3

    BoxLayout:
        orientation: 'vertical'

        Label:
            text:"Input savelist's name :"
            shorten_from:"right" 
            size_hint_x:0.5                   

        TextInput:            
            id:savelistName
            size_hint_y:None
            text:"lastConfig"
            height:32
            multiline:False

        Label:
            height:5
            size_hint_y:None
            
        BoxLayout:
            orientation:'horizontal'
            padding:4
            height:42
            size_hint_y:None

            Button:
                text:"Save"
                on_release:app.handle_saveExecuteList(root)

            Button:
                text:"Cancel"
                on_release:root.dismiss()

<LoadListPopUp>
    size_hint:.2,.6
    pos:0,0

    BoxLayout:
        id:configLoadList
        orientation:'vertical'

        Label:
            text:"SettingList :"
            height:30
            size_hint_y:None


        RecycleView:
            data:root.data_for_loadConfigList
            viewclass:root.listItemClass
            RecycleBoxLayout:
                default_size:None,dp(30)
                default_size_hint:1,None
                size_hint_y:None
                height:self.minimum_height
                orientation:"vertical"
                spacing:dp(2)

            

<LoadListPopUpItem>
    orientation:'horizontal'
    height:48
    size_hint_y:None

    Label:
        size_hint_x:.7
        text:root.config_title

    Button:
        size_hint_x:.3
        text:"Load"
        on_release:app.handle_loadExecuteList(root)


<LoadListPopUpItem_ScriptEdit>
    orientation:'horizontal'
    height:48
    size_hint_y:None
    padding:2

    Label:
        size_hint_x:.75
        text:root.savedEditArgs_savedName

    Button:
        size_hint_x:.25
        text:"Load"
        on_release:root.handle_scriptEdit_load()


<ScriptSettings>
    size_hint_y:1
    size_hint_x:1
    orientation:'vertical'    


    BackgroundLabel:
        text:"ScriptSettings"
        height:36
        valign:"top"
        size_hint_y:None

    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.1
        height:60
        Label:
            text:"Device ID"

        TextInput:
            text:"Now is defalut"            

    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.2
        height:60
        Label:
            text:"Start with \n StarUp.air"

        Switch:
            id:switch_startWithStarUp
            active:False

    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.2
        height:60
        Label:
            text:"Save Script log"
        Switch:
            id:switch_saveLog
            active:False

    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.2
        height:60
        Label:
            text:"Try Once"

        Switch:
            active:False

    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.2
        height:60
        Label:
            text:"Notify&wait handle\n  when error"
            font_size:14

        Switch:
            active:False
    
    BoxLayout:
        orientation:'horizontal'
        size_hint_y:0.2
        height:60
        Label:
            text:"Clear all script\nin Excutelist"
        GridLayout:    
            rows:1        
            size_hint_y:0.5
            pos_hint:{'top': 0.6}       
            pos:0,self.parent.height/2-self.height/2             
            Button:             
                text:"clear"
                on_release:app.handle_clearExecuteList()

    BoxLayout:
        size_hint_y:.8



<Log>
    size_hint_x:1
    orientation:"vertical"

    BackgroundLabel:
        height:18
        text:"Log"
        halign:"left"  
        font_size:16
        size_hint_y:None
        background_color:.3,.3,.3,1

    CodeInput:
        id:logShow
        padding:2
        font_size:12
        text:root.logData
        readonly:True

        

<ScriptExecute>
    size_hint_y:.2
    Button:
        text:"Script\nExecute"
        size_hint:1,None
        height:120
        on_release:app.handle_ExecuteListRun()
    Button:
        size_hint:1,None
        height:120
        text:"Stop"
        on_release:app.handle_stopNowProcess()

